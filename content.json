{"meta":{"title":"iAkira","subtitle":"此处还缺一杯红酒","description":null,"author":"iAkira","url":"https://t.iakira.net","root":"/"},"pages":[{"title":"404 Not Found","date":"2019-05-22T16:03:56.788Z","updated":"2019-05-22T16:03:56.788Z","comments":true,"path":"404.html","permalink":"https://t.iakira.net/404.html","excerpt":"","text":"404 Not Found 很抱歉，您访问的页面不存在可能是输入地址有误或该地址已被删除"},{"title":"about","date":"2019-05-19T09:08:00.000Z","updated":"2019-05-21T15:25:13.528Z","comments":true,"path":"about/index.html","permalink":"https://t.iakira.net/about/index.html","excerpt":"","text":"iAkira此处还却一杯红酒"},{"title":"archives","date":"2019-05-19T09:50:18.000Z","updated":"2019-05-19T09:50:18.705Z","comments":true,"path":"archives/index.html","permalink":"https://t.iakira.net/archives/index.html","excerpt":"","text":""},{"title":"所有分类","date":"2019-05-19T10:24:27.445Z","updated":"2019-05-19T10:24:27.445Z","comments":true,"path":"categories/index.html","permalink":"https://t.iakira.net/categories/index.html","excerpt":"","text":""},{"title":"所有标签","date":"2019-05-19T15:06:45.000Z","updated":"2019-05-19T15:11:53.197Z","comments":true,"path":"tags/index.html","permalink":"https://t.iakira.net/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"pacman 命令的基本用法","slug":"pacman","date":"2019-03-04T07:40:11.000Z","updated":"2019-05-19T15:01:36.277Z","comments":true,"path":"pacman/","link":"","permalink":"https://t.iakira.net/pacman/","excerpt":"pacman命令的基本用法查看包组的软件pacman -Sg groups 安装一个包pacman -S pkg_name","text":"pacman命令的基本用法查看包组的软件pacman -Sg groups 安装一个包pacman -S pkg_name 升级整个系统pacman -Syu 升级系统时安装其他软件包pacman -Syu pkg_name 同步数据库pacman -Sy 卸载软件包及其依赖pacman -Rsc pkg_name 只卸载软件包而不卸载其依赖pacman -Rdd pkg_name 查询文件所属的包pacman -Fs file 数据库中查找包名及其描述pacman -Ss str1 str2 查找已安装的包及其描述pacman -Qs str1 str2 下载软件包而不安装pacman -Sw pkg_name 将软件包保存到本地pacman -U file://path/to/pkg_name-version.pkg.tar.xz 从本地安装软件包-pacman -U /pach/to/pkg_name.pkg.tar.xz","categories":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/tags/Linux/"},{"name":"ArchLinux","slug":"ArchLinux","permalink":"https://t.iakira.net/tags/ArchLinux/"}]},{"title":"CentOS 7 安装 Nextcloud","slug":"centos-7-nextcloud","date":"2018-06-18T09:17:27.000Z","updated":"2019-05-19T15:00:03.757Z","comments":true,"path":"centos-7-nextcloud/","link":"","permalink":"https://t.iakira.net/centos-7-nextcloud/","excerpt":"安装 php 7.1 和 Nextcloud 需要的包 123yum install -y epel-releaserpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpmyum install -y php71w-fpm php71w-gd php71w-mbstring php71w-mysqlnd php71w-opcache php71w-cli php71w-xml php71w-mcrypt php71w-common php71w-pdo php71w-pecl-apcu php71w-pear 安装 Apache 1yum install -y apache 安装和配置 MariaDB 1yum -y install mariadb mariadb-server 启动 MariaDB 并添加到开机启动的服务。12systemctl start mariadbsystemctl enable mariadb 设置 MariaDB root 用户的密码。1mysql_secure_installation","text":"安装 php 7.1 和 Nextcloud 需要的包 123yum install -y epel-releaserpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpmyum install -y php71w-fpm php71w-gd php71w-mbstring php71w-mysqlnd php71w-opcache php71w-cli php71w-xml php71w-mcrypt php71w-common php71w-pdo php71w-pecl-apcu php71w-pear 安装 Apache 1yum install -y apache 安装和配置 MariaDB 1yum -y install mariadb mariadb-server 启动 MariaDB 并添加到开机启动的服务。12systemctl start mariadbsystemctl enable mariadb 设置 MariaDB root 用户的密码。1mysql_secure_installation 按照提示操作即可，然后为 Nextcloud 创建一个新的数据路 nextcloud_db 和用户 nextclouduser。1mysql -u root -p 输入刚才的密码即可登录 mysql shell，输入下面的命令创建数据库和用户。12345create database nextcloud_db;create user nextclouduser@localhost identified by 'passwd';grant all privileges on nextcloud_db.* to nextclouduser@localhost identified by 'passwd';flush privileges;exit 下载安装 Nextcloud 12345wget https://download.nextcloud.com/server/releases/nextcloud-13.0.4.tar.bz2tar -xjvf nextcloud-13.0.4.tar.bz2 mv nextcloud /var/www/html/chown -R apache:apache /var/www/html/nextcloudchmod -R 755 /var/www/html/nextcloud 为 Nextcloud 新建虚拟主机 新建一个配置文件nextcloud.conf。1vi /etc/httpd/conf.d/nextcloud.conf 把类似以下的内容粘贴到配置文件中。123456789&lt;VirtualHost *:80&gt; &lt;Directory /var/www/html/nextcloud/&gt; AllowOverride All &lt;/Directory&gt; ServerName domain.com IndexOptions Charset=UTF-8 DocumentRoot \"/var/www/html/nextcloud/\" RewriteEngine on&lt;/VirtualHost&gt; 在/etc/httpd/conf/httpd.conf的最后加上以下内容。1234&lt;FilesMatch \\.php$&gt;# SetHandler application/x-httpd-php SetHandler \"proxy:fcgi://127.0.0.1:9000\"&lt;/FilesMatch&gt; 启动 php-fpm 和 Apache，并且将它们设置为开机启动的服务。1234systemctl start php-fpmsystemctl enable php-fpmsystemctl start httpdsystemctl enable httpd 防火墙的配置 开启 http 和 https 端口。123firewall-cmd --permanent --add-service=httpfirewall-cmd --permanent --add-service=httpsfirewall-cmd --reload 然后可以通过certbot启用https，访问 domain.com 即可完成安装。 SELinux 的问题 如果按照上面的步骤安装好后，无法访问 domain.com，出现下面的错误，有可能就是SELinux的问题。先运行 setenforce 0，如果仍不能访问，则有可能是那个地方没做好，如果能访问则继续往下。123456semanage fcontext -a -t httpd_sys_rw_content_t '/var/www/html/nextcloud/data(/.*)?'semanage fcontext -a -t httpd_sys_rw_content_t '/var/www/html/nextcloud/config(/.*)?'semanage fcontext -a -t httpd_sys_rw_content_t '/var/www/html/nextcloud/apps(/.*)?'semanage fcontext -a -t httpd_sys_rw_content_t '/var/www/html/nextcloud/.htaccess'semanage fcontext -a -t httpd_sys_rw_content_t '/var/www/html/nextcloud/.user.ini'restorecon -Rv '/var/www/html/nextcloud/' 更多SELinux相关的问题请看这里。 安全及设置警告 在基本设置中有可能会看到安全及设置警告。 安全及设置警告 你的每项配置对于实例的安全性和性能都至关重要。 为了帮助您，我们正在做一些自动检查。有关详细信息，请参阅提示与技巧部分和文档。 HTTP 请求头 “Strict-Transport-Security” 没有配置为至少“15552000” 秒。 出于增强安全性考虑, 推荐按照安全提示中的说明启用HSTS。内存缓存未配置，为了提升使用体验，请尽量配置内存缓存。更多信息请参见文档。 PHP 的组件 OPcache没有正确配置。为了提供更好的性能，我们建议在php.ini中使用下列设置： opcache.enable=1 opcache.enable_cli=1 opcache.interned_strings_buffer=8 opcache.max_accelerated_files=10000 opcache.memory_consumption=128 opcache.save_comments=1 opcache.revalidate_freq=1 请仔细检查安装指南，并检查日志中是否有错误或警告。 完全可以不管它的，有强迫症的，按以下步骤解决。 在/var/www/html/nextcloud/.htaccess最后加上123&lt;IfModule mod_headers.c&gt;Header always set Strict-Transport-Security \"max-age=15552000; includeSubDomains\"&lt;/IfModule&gt; 在 Nextcloud 的config.php文件加上&#39;memcache.local&#39; =&gt; &#39;\\OC\\Memcache\\APCu&#39;,。 编辑/etc/php.d/opcache.ini在相应的地方改为下面的值。1234567opcache.enable=1opcache.enable_cli=1opcache.interned_strings_buffer=8opcache.max_accelerated_files=10000opcache.memory_consumption=128opcache.save_comments=1opcache.revalidate_freq=1 最后重启一下服务即可。 外部存储 在应用管理界面启用 External storage support，打开外部存储设置页面，可能会提示“没有安装 &quot;smbclient&quot;. 无法挂载 &quot;SMB / CIFS&quot;, &quot;SMB / CIFS 使用 OC 登录信息 &quot;.请联系您的系统管理员安装.”解决方法如下。1yum -y install samba-client 重启php-fpm生效。","categories":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/categories/Linux/"}],"tags":[{"name":"Nextcloud","slug":"Nextcloud","permalink":"https://t.iakira.net/tags/Nextcloud/"},{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/tags/Linux/"},{"name":"网盘","slug":"网盘","permalink":"https://t.iakira.net/tags/网盘/"}]},{"title":"删除CentOS 7 \"with debugging\"的启动选项","slug":"remove-centos-7-menuentry-with-debugging","date":"2018-05-03T10:13:02.000Z","updated":"2019-05-19T15:03:51.394Z","comments":true,"path":"remove-centos-7-menuentry-with-debugging/","link":"","permalink":"https://t.iakira.net/remove-centos-7-menuentry-with-debugging/","excerpt":"编辑/etc/sysconfig/kernel， 把&quot;MAKEDEBUG=yes这行行删掉或者注释掉。123# MAKEDEBUG specifies if new-kernel-pkg should create non-default# \"debug\" entries for new kernels.# MAKEDEBUG=yes 最后执行grub2-mkconfig -o /boot/grub2/grub.cfg","text":"编辑/etc/sysconfig/kernel， 把&quot;MAKEDEBUG=yes这行行删掉或者注释掉。123# MAKEDEBUG specifies if new-kernel-pkg should create non-default# \"debug\" entries for new kernels.# MAKEDEBUG=yes 最后执行grub2-mkconfig -o /boot/grub2/grub.cfg","categories":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/tags/Linux/"},{"name":"Centos 7","slug":"Centos-7","permalink":"https://t.iakira.net/tags/Centos-7/"}]},{"title":"CentOS 7开启bbr","slug":"centos7-bbr","date":"2017-12-20T14:16:41.000Z","updated":"2019-05-19T15:08:14.054Z","comments":true,"path":"centos7-bbr/","link":"","permalink":"https://t.iakira.net/centos7-bbr/","excerpt":"安装最新内核123rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.orgrpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpmyum --enablerepo=elrepo-kernel install kernel-ml 列出已安装的内核1awk -F\\' '$1==\"menuentry \" &#123;print i++ \" : \" $2&#125;' /etc/grub2.cfg 输出类似信息123450 : CentOS Linux (3.10.0-693.21.1.el7.x86_64) 7 (Core)1 : CentOS Linux (4.14.12-1.el7.elrepo.x86_64) 7 (Core)2 : CentOS Linux (3.10.0-693.11.6.el7.x86_64) 7 (Core)3 : CentOS Linux (0-rescue-0c956a18d98e4e58b6ee2f208c877d87) 7 (Core)4 : CentOS Linux (0-rescue-f93f471fcefa4190a918621cd9b830e9) 7 (Core) 把最新内核设为默认启动 1grub2-set-default 'CentOS Linux (4.14.12-1.el7.elrepo.x86_64) 7 (Core)' 重启，查看当前内核 1uname -a 输出Linux localhost 4.14.12-1.el7.elrepo.x86_64 #1 SMP Fri Jan 5 13:28:56 EST 2018 x86_64 x86_64 x86_64 GNU/Linux，内核更换成功。","text":"安装最新内核123rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.orgrpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpmyum --enablerepo=elrepo-kernel install kernel-ml 列出已安装的内核1awk -F\\' '$1==\"menuentry \" &#123;print i++ \" : \" $2&#125;' /etc/grub2.cfg 输出类似信息123450 : CentOS Linux (3.10.0-693.21.1.el7.x86_64) 7 (Core)1 : CentOS Linux (4.14.12-1.el7.elrepo.x86_64) 7 (Core)2 : CentOS Linux (3.10.0-693.11.6.el7.x86_64) 7 (Core)3 : CentOS Linux (0-rescue-0c956a18d98e4e58b6ee2f208c877d87) 7 (Core)4 : CentOS Linux (0-rescue-f93f471fcefa4190a918621cd9b830e9) 7 (Core) 把最新内核设为默认启动 1grub2-set-default 'CentOS Linux (4.14.12-1.el7.elrepo.x86_64) 7 (Core)' 重启，查看当前内核 1uname -a 输出Linux localhost 4.14.12-1.el7.elrepo.x86_64 #1 SMP Fri Jan 5 13:28:56 EST 2018 x86_64 x86_64 x86_64 GNU/Linux，内核更换成功。 编辑/etc/sysctl.conf在末尾加入以下内容 12net.core.default_qdisc = fqnet.ipv4.tcp_congestion_control = bbr 运行sysctl -p使配置生效运行lsmod | grep &#39;bbr&#39;查看BBR是否启动，看到有tcp_bbr 即说明bbr已启动。","categories":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://t.iakira.net/tags/Linux/"},{"name":"bbr","slug":"bbr","permalink":"https://t.iakira.net/tags/bbr/"},{"name":"Centos 7","slug":"Centos-7","permalink":"https://t.iakira.net/tags/Centos-7/"}]}]}